<?xml version="1.0" encoding="UTF-8"?>
<!--
    manpage for RTIsoMaker/VISO

    Copyright (C) 2006-2017 Oracle Corporation

    This file is part of VirtualBox Open Source Edition (OSE), as
    available from http://www.virtualbox.org. This file is free software;
    you can redistribute it and/or modify it under the terms of the GNU
    General Public License (GPL) as published by the Free Software
    Foundation, in version 2 as it comes in the "COPYING" file of the
    VirtualBox OSE distribution. VirtualBox OSE is distributed in the
    hope that it will be useful, but WITHOUT ANY WARRANTY of any kind.
 -->
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<refentry id="rtisomaker" lang="en">

  <refentryinfo>
    <pubdate>$Date$</pubdate>
    <title>VISO file format / RTIsoMaker</title>
  </refentryinfo>

  <refmeta>
    <refentrytitle>RTIsoMaker</refentrytitle>
    <manvolnum>8</manvolnum>
  </refmeta>

  <refnamediv>
    <!--<refname>VISO</refname>-->
    <refname>RTIsoMaker</refname>
    <refpurpose>ISO image maker</refpurpose>
    <refclass>IPRT</refclass>
  </refnamediv>

  <refsynopsisdiv>
    <cmdsynopsis id="synopsis-rtisomaker"> <!-- The 'id' is mandatory and must start with 'synopsis-'. -->
      <command>RTIsoMaker</command>
      <arg><replaceable>options</replaceable></arg>
      <arg>@<replaceable>commands.rsp</replaceable></arg>
      <arg choice="req" rep="repeat"><replaceable>filespec</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>
    <para>Construct a virtual ISO 9660 / Joliet / UDF / HFS hybrid image and either write it to a
    file (RTIsoMaker) or serve it as a virtual image (VISO).</para>

    <refsect2 id="rtisomaker-viso">
      <title>VISO file format</title>
      <para>A VISO file is a virtual ISO image, i.e. constructed in memory from a bunch of files on
        the host.  A VISO is just the recipe describing how to go about this using a syntax vaguely
        similar to mkisofs and genisoimage.</para>

      <para>One requirement is that the VISO file must start with one of the
        <option>--iprt-iso-maker-file-marker</option> options. Which of the options you use will
        dictate the quoting and escaping rules used when reading the file.  The option takes the
        image UUID as an argument.</para>

      <para>The VISO files are treated as UTF-8 and must not contain any byte order marker (BOM).
        There is currently no way to comment out lines in a VISO file.</para>

    </refsect2>

    <refsect2 id="rtisomaker-filespecs">
      <title>File specifications and --name-setup</title>
      <para>All non-options that does not start with '@' are taken to indicate a file, directory,
        or similar that is should be added to the ISO image.  Directories are added recursively and
        content is subject to filtering options.</para>

      <para>Since there can be up to six different namespaces on an ISO, it is handy to be able to
        control the names used in each and be able to exclude an object from one or more namespaces.
        The <option>--name-setup</option> option specifies the file specification format to use
        forthwith.</para>

      <para>The default setup is:</para>
      <!-- indent this: -->
      <para><computeroutput>    --name-setup iso+joliet+udf+hfs</computeroutput></para>

      <para>Which means you specify one on-ISO name for all namespaces followed by '=' and the
        source file system name.  Only specifying the source file system will add the
        file/dir/whatever to the root of the ISO image.</para>

      <para>Lets look at the following two examples:</para>

      <!-- indent these -->
      <para><computeroutput>    /docs/readme.txt=/home/user/Documents/product-x-readme.txt</computeroutput></para>
      <para><computeroutput>    /home/user/Documents/product-x-readme.txt</computeroutput></para>

      <para>In the first case the file <computeroutput>'/home/user/Documents/product-x-readme.txt'</computeroutput>
        is added to the ISO image as <computeroutput>'/docs/readme.txt'</computeroutput> in all
        enabled namespaces.  In the primary ISO 9660 namespace, the filename will by default be
        converted to upper case because it's required by the spec.</para>

      <para>In the second case the file is added to the root under the name
        <computeroutput>'product-x-readme.txt'</computeroutput> in all namespaces. Though, in the
        primary ISO 9660 namespace the name will be transformed to apply with the current ISO level,
        probably uppercased, possibly truncated too. </para>

      <para>Given  <option>--name-setup iso,joliet,udf</option>  you can specify the name individually
        for each of the three namespace, if you like.  If you omit any, they will use last name given.
        Any names left blank (<computeroutput>==</computeroutput>) will be considered omitted.</para>

      <para>A different name in each namespace:</para>
      <para><computeroutput>    /ISO.TXT=/Joliet.TxT=/UDF.txt=/tmp/iso/real.txt</computeroutput></para>
      <para>Specific name in the ISO 9660 namespace, same in the rest:</para>
      <para><computeroutput>    /ISO.TXT=/OtherNamespaces.TxT=/tmp/iso/real.txt</computeroutput></para>
      <para>Omit the file from the ISO 9660 namespace:</para>
      <para><computeroutput>    =/OtherNamespaces.TxT=/tmp/iso/real.txt</computeroutput></para>
      <para>Omit the file from the joliet namespace:</para>
      <para><computeroutput>    /ISO.TXT==/UDF.TxT=/tmp/iso/real.txt</computeroutput></para>
      <para>Use the same filename as the source everywhere:</para>
      <para><computeroutput>    /tmp/iso/real.txt</computeroutput></para>


      <para>Using for instance  <option>--name-setup udf</option>  you can add a files/dirs/whatever
        to select namespace(s) without the more complicated empty name syntax above.</para>

      <para>When adding directories, you can only control the naming and omitting of the directory
        itself, not any recursively added files and directories below it.</para>

    </refsect2>
  </refsect1>

  <refsect1 id="rtisomaker-general-options">
    <title>Options - General</title>

    <variablelist>
      <varlistentry>
        <term><option>-o <replaceable>output-file</replaceable></option></term>
        <term><option>--output=<replaceable>output-file</replaceable></option></term>
        <listitem><para>The output filename.  This option is not supported in VISO mode.</para></listitem>
      </varlistentry>

      <varlistentry>
        <term><option>--name-setup <replaceable>spec</replaceable></option></term>
        <listitem><para>Configures active namespaces and how file specifications are to be
            interpreted.  The specification is a comma separated list.  Each element in the list is
            a sub-list separated by space, <computeroutput>'+'</computeroutput> or
            <computeroutput>'|'</computeroutput> giving the namespaces that elements controls.
            Namespaces are divied into two major and minor ones, you cannot specifying a minor
            before the major it belongs to.</para>
         <para>Major namespaces and aliases in parentheses:</para>
         <itemizedlist>
           <listitem><para>iso (primary, iso9660, iso-9660, primary-iso, iso-primary)</para></listitem>
           <listitem><para>joliet</para></listitem>
           <listitem><para>udf</para></listitem>
           <listitem><para>hfs (hfs-plus)</para></listitem>
         </itemizedlist>
         <para>Minor namespaces:</para>
         <itemizedlist>
            <listitem><para>rock:        rock ridge on previous major namespace (iso / joliet)</para></listitem>
            <listitem><para>iso-rock:    rock ridge extensions on primary ISO 9660 namespace</para></listitem>
            <listitem><para>joliet-rock: rock ridge on joliet namespace (just for fun)</para></listitem>
            <listitem><para>trans-tbl:   translation table file on previous major namespace</para></listitem>
            <listitem><para>iso-trans-tbl</para></listitem>
            <listitem><para>joliet-trans-tbl</para></listitem>
            <listitem><para>udf-trans-tbl</para></listitem>
            <listitem><para>hfs-trans-tbl</para></listitem>
         </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>

  </refsect1>

</refentry>


<!--


Options - General:



    -dashdash-push-iso <iso-file>
    -dashdash-push-iso-no-joliet <iso-file>
    -dashdash-push-iso-no-rock <iso-file>
    -dashdash-push-iso-no-rock-no-joliet <iso-file>
        Open the specified ISO file and use it as source file system until the
        corresponding -dashdash-pop options is encountered.  The variations are for
        selecting which namespace on the ISO to (not) access.  These options
        are handy for copying files/directories/stuff from an ISO without
        having to extract them first or using the :iprtvfs: syntax.

    -dashdash-pop
        Pops a -dashdash-push-iso of the source file system stack.

    -dashdash-import-iso <iso-file>
        Imports everything on the given ISO file. You can use -dashdash-name-setup to
        omit namespaces.


Options - Namespaces:

    -dashdash-iso-level <0|1|2|3>
        Sets the ISO level:
            - 0: Disable primary ISO namespace.
            - 1: ISO level 1: Filenames 8.3 format and limited to 4GB - 1.
            - 2: ISO level 2: 31 char long names and limited to 4GB - 1.
            - 3: ISO level 3: 31 char long names and support for >=4GB files.
            - 4: Fictive level used by other tools. Not yet implemented.
        Default: 3

    -dashdash-rock-ridge
    -dashdash-limited-rock-ridge
    -dashdash-no-rock-ridge
        Enables or disables rock ridge support for the primary ISO 9660
        namespace.  The -dashdash-limited-rock-ridge option omits a couple of bits in
        the root directory that would make Linux pick rock ridge over joliet.
        Default: -dashdash-limited-rock-ridge
    -J
    -dashdash-joliet
    -dashdash-no-joliet
        Enables or disable the joliet namespace.  This option must precede any
        file specifications.  Default: -dashdash-joliet

    -dashdash-joliet-ucs-level <1|2|3>
    -dashdash-ucs-level <1|2|3>
        Set the Joliet UCS support level.  This is currently only flagged in the
        image but not enforced on the actual path names.  Default level: 3


Options - File attributes:

    -dashdash-rational-attribs
        Enables rational file attribute handling:
            * Owner ID is set to zero
            * Group ID is set to zero
            * Mode is set to 0444 for non-executable files.
            * Mode is set to 0555 for executable files.
            * Mode is set to 0555 for directories, preserving stick bits.
        This is default.

    -dashdash-strict-attribs
        Counters -dashdash-rational-attribs and causes attributes to be recorded
        exactly as they appear in the source.

    -dashdash-file-mode <mode>
    -dashdash-no-file-mode
        Controls the forced file mode mask for rock ridge, UDF and HFS.

    -dashdash-dir-mode <mode>
    -dashdash-no-dir-mode
        Controls the forced directory mode mask for rock ridge, UDF and HFS.

    -dashdash-new-dir-mode <mode>
        Controls the default mode mask (rock ridge, UDF, HFS) for directories
        that are created implicitly.  The -dashdash-dir-mode option overrides this.

    -dashdash-chmod <mode>:<on-iso-file>
       Explictily sets the rock ridge, UDF and HFS file mode for a
       file/dir/whatever that has already been added to the ISO.  The mode can
       be octal, a+x, a+r, or a+rx.  (Support for more complicated mode
       specifications may be implemented at a later point.)
       Note that only namespaces in the current -dashdash-name-setup are affected.

    -dashdash-chown <owner-id>:<on-iso-file>
       Explictily sets the rock ridge, UDF and HFS file owner ID (numeric) for a
       file/dir/whatever that has already been added to the ISO.
       Note that only namespaces in the current -dashdash-name-setup are affected.

    -dashdash-chgrp <group-id>:<on-iso-file>
       Explictily sets the rock ridge, UDF and HFS file group ID (numeric) for a
       file/dir/whatever that has already been added to the ISO.
       Note that only namespaces in the current -dashdash-name-setup are affected.


Options - Booting:

    -dashdash-eltorito-new-entry
    -dashdash-eltorito-alt-boot
        Starts a new El Torito boot entry.

    -dashdash-eltorito-add-image <filespec>
        File specification of a file that should be added to the image and used
        as the El Torito boot image of the current boot entry.

    -b <on-iso-file>
    -dashdash-eltorito-boot <on-iso-file>
        Specifies a file on the ISO as the El Torito boot image for the current
        boot entry.

    -dashdash-eltorito-floppy-12
    -dashdash-eltorito-floppy-144
    -dashdash-eltorito-floppy-288
    -dashdash-no-emulation-boot
    -dashdash-hard-disk-boot
        Sets the boot image emulation type of the current El Torito boot entry.

    -dashdash-boot-load-seg <seg>
        Specify the image load segment for the current El Torito boot entry.
        Default: 0x7c0

    -dashdash-boot-load-size <seg>
        Specify the image load size in emulated sectors for the current El Torito
        boot entry.  Default: 4 (sectors of 512 bytes)

    -dashdash-no-boot
        Indicates that the current El Torito boot entry isn't bootable. (The
        BIOS will allegedly configure the emulation, but not attempt booting.)

    -dashdash-boot-info-table
        Write a isolinux/syslinux boot info table into the boot image for the
        current El Torito boot entry.

    -dashdash-eltorito-platform-id <id>
        Set the El Torito platform ID of the current entry, a new entry of the
        verification entry depending on when it's used.  The ID must be one
        of: x86, PPC, Mac, efi

    -c <namespec>
    -dashdash-boot-catalog <namespec>
        Enters the El Torito boot catalog into the namespaces as a file.  The
        'namespec' uses the same format as a 'filespec', but omits the final
        source file system name component.

    -G <file>
    -dashdash-generic-boot <file>
        Specifies a file that should be loaded at offset 0 in the ISO image.
        The file must not be larger than 32KB.  When creating a hybrid image,
        parts of this may be regenerated by partition tables and such.


Options - String properties (applied to active namespaces only):

    -dashdash-abstract <file-id>
        The name of the abstract file in the root dir.

    -A <text|_file-id>
    -dashdash-application-id <text|_file-id>
        Application ID string or root file name.  The latter must be prefixed
        with an underscore.

    -dashdash-biblio <file-id>
        The name of the bibliographic file in the root dir.

    -dashdash-copyright <file-id>
        The name of the copyright file in the root dir.

    -P <text|_file-id>
    -dashdash-publisher <text|_file-id>
        Publisher ID string or root file name.  The latter must be prefixed
        with an underscore.

    -p <text|_file-id>
    -dashdash-preparer <text|_file-id>
        Data preparer ID string or root file name.  The latter must be prefixed
        with an underscore.

    -dashdash-sysid <text>
        System ID string.

    -dashdash-volid <text>
    -dashdash-volume-id <text>
        Volume ID string (label).  (It is possible to set different labels for
        primary ISO 9660, joliet, UDF and HFS by changing the active namespaces
        using the -dashdash-name-setup option between -dashdash-volume-id occurences.)

    -dashdash-volset <text>
        Volume set ID string.


Options - Compatibility:

    -dashdash-graft-points
        Alias for -dashdash-name-setup iso+joliet+udf+hfs.

    -l
    -dashdash-long-names
        Allow 31 charater filenames.  Just ensure ISO level >= 2 here.

    -R
    -dashdash-rock
        Same as -dashdash-rock-ridge and -dashdash-strict-attribs.

    -r
    -dashdash-rational-rock
        Same as -dashdash-rock-ridge and -dashdash-rational-attribs.


Options - VISO specific:

    -dashdash-iprt-iso-maker-file-marker <UUID>
    -dashdash-iprt-iso-maker-file-marker-bourne <UUID>
    -dashdash-iprt-iso-maker-file-marker-bourne-sh <UUID>
        Used as first option in a VISO file to specify the file UUID and that
        it is formatted using bourne-shell argument quoting & escaping style.

    -dashdash-iprt-iso-maker-file-marker-ms <UUID>
    -dashdash-iprt-iso-maker-file-marker-ms-sh <UUID>
        Used as first option in a VISO file to specify the file UUID and that
        it is formatted using microsoft CRT argument quoting & escaping style.


Options - Testing (not applicable to VISO):

    -dashdash-output-buffer-size <bytes>
        Selects a specific output buffer size for testing virtual image reads.

    -dashdash-random-output-buffer-size
        Enables randomized buffer size for each virtual image read, using the
        current output buffer size (-dashdash-output-buffer-size) as maximum.

    -dashdash-random-order-verification <size>
        Enables verification pass of the image that compares blocks of the given
        size in random order from the virtual and output images


 -->
